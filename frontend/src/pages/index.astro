---
import BaseLayout from '../layouts/BaseLayout.astro';
import { CountryDropdown } from '../components/CountryDropdown';
import type { CountryMeta } from '../lib/types';

// Import countries data from src/assets - Vite will handle cache-busting
import countriesData from '../assets/data/countries.json';

const countries = (countriesData.countries || []) as CountryMeta[];

function formatYearRange(range: [number, number]): string {
  return `${range[0]}–${range[1]}`;
}
---

<BaseLayout
  title="Countries"
  description={`Explore fertility rates and birth seasonality patterns across ${countries.length} countries. Data from the Human Mortality Database and UN Population Division.`}
  canonicalPath="/"
>
  <h1>Birth Seasonality Heatmaps</h1>
  <p style="margin-bottom: var(--space-xl); color: var(--color-text-muted);">
    Explore fertility rates and birth seasonality patterns across {countries.length} countries.
    Data from the Human Mortality Database and UN Population Division.
  </p>

  <div style="margin-bottom: var(--space-xl); display: flex; justify-content: center;">
    <CountryDropdown
      client:load
      countries={countries}
      metric="fertility"
    />
  </div>

  {countries.length > 0 ? (
    <div class="country-grid">
      {countries.map((country) => (
        <a href={`/fertility/${country.code}`} class="country-card">
          <h3>{country.name}</h3>
          <p class="sources">
            Sources: {country.sources.join(', ')}
          </p>
          <p class="year-range">
            {formatYearRange(country.fertility.yearRange)} · {country.completeYears} complete years
          </p>
        </a>
      ))}
    </div>
  ) : (
    <div class="card">
      <h2>No Data Available</h2>
      <p>
        Run the data pipeline to generate country data:
      </p>
      <pre style="background: var(--color-bg); padding: var(--space-md); border-radius: 4px; overflow-x: auto;">
python data-pipeline/scripts/run_pipeline.py --json
      </pre>
    </div>
  )}
</BaseLayout>

<style>
  h1 {
    margin-bottom: var(--space-sm);
  }
</style>
